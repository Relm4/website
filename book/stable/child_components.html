<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Child components - GUI development with Relm4</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="basic_concepts/index.html"><strong aria-hidden="true">1.</strong> Basic concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basic_concepts/model.html"><strong aria-hidden="true">1.1.</strong> Model</a></li><li class="chapter-item expanded "><a href="basic_concepts/messages.html"><strong aria-hidden="true">1.2.</strong> Messages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basic_concepts/messages/input.html"><strong aria-hidden="true">1.2.1.</strong> Input</a></li><li class="chapter-item expanded "><a href="basic_concepts/messages/output.html"><strong aria-hidden="true">1.2.2.</strong> Output</a></li></ol></li><li class="chapter-item expanded "><a href="basic_concepts/widgets.html"><strong aria-hidden="true">1.3.</strong> Widgets</a></li><li class="chapter-item expanded "><a href="basic_concepts/components.html"><strong aria-hidden="true">1.4.</strong> Components</a></li></ol></li><li class="chapter-item expanded "><a href="first_app.html"><strong aria-hidden="true">2.</strong> Your first app</a></li><li class="chapter-item expanded "><a href="component_macro.html"><strong aria-hidden="true">3.</strong> The component macro</a></li><li class="chapter-item expanded "><a href="tricks.html"><strong aria-hidden="true">4.</strong> Tips and tricks</a></li><li class="chapter-item expanded "><a href="efficient_ui/index.html"><strong aria-hidden="true">5.</strong> Efficient UI updates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="efficient_ui/tracker.html"><strong aria-hidden="true">5.1.</strong> Tracker</a></li><li class="chapter-item expanded "><a href="efficient_ui/factory.html"><strong aria-hidden="true">5.2.</strong> Factories</a></li><li class="chapter-item expanded "><a href="efficient_ui/factory_position.html"><strong aria-hidden="true">5.3.</strong> The position function</a></li></ol></li><li class="chapter-item expanded "><a href="components.html"><strong aria-hidden="true">6.</strong> Components</a></li><li class="chapter-item expanded "><a href="threads_and_async/index.html"><strong aria-hidden="true">7.</strong> Threads and async</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="threads_and_async/worker.html"><strong aria-hidden="true">7.1.</strong> Workers</a></li><li class="chapter-item expanded "><a href="threads_and_async/commands.html"><strong aria-hidden="true">7.2.</strong> Commands</a></li><li class="chapter-item expanded "><a href="threads_and_async/async.html"><strong aria-hidden="true">7.3.</strong> Async components and factories</a></li><li class="chapter-item expanded "><a href="threads_and_async/overview.html"><strong aria-hidden="true">7.4.</strong> Overview</a></li></ol></li><li class="chapter-item expanded "><a href="child_components.html" class="active"><strong aria-hidden="true">8.</strong> Child components</a></li><li class="chapter-item expanded "><a href="widget_templates.html"><strong aria-hidden="true">9.</strong> Widget templates</a></li><li class="chapter-item expanded "><a href="gtk_rs.html"><strong aria-hidden="true">10.</strong> gtk-rs overview</a></li><li class="chapter-item expanded "><a href="resource_bundles.html"><strong aria-hidden="true">11.</strong> Resource Bundles</a></li><li class="chapter-item expanded "><a href="component_macro/reference.html"><strong aria-hidden="true">12.</strong> Component macro reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="component_macro/expansion.html"><strong aria-hidden="true">12.1.</strong> Macro expansion</a></li></ol></li><li class="chapter-item expanded "><a href="migrations/index.html"><strong aria-hidden="true">13.</strong> Migration guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="migrations/0_2_to_0_4.html"><strong aria-hidden="true">13.1.</strong> 0.2 to 0.4</a></li><li class="chapter-item expanded "><a href="migrations/0_4_to_0_5.html"><strong aria-hidden="true">13.2.</strong> 0.4 to 0.5</a></li><li class="chapter-item expanded "><a href="migrations/0_5_to_0_6.html"><strong aria-hidden="true">13.3.</strong> 0.5 to 0.6</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GUI development with Relm4</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Relm4/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Relm4/book/edit/main/src/child_components.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="child-components"><a class="header" href="#child-components">Child components</a></h1>
<p>In this chapter, we will implement a simple alert dialog as a reusable child component.</p>
<p>The alert example in the Relm4 repository implements a simple app for the alert component that we will write in this chapter. It's an other variant of a counter app, yet this time a dialog will be displayed if the counter does not match 42 when closing. The main difference in the implementation is, that the dialog is implemented as component that can be reused in other applications.</p>
<p><img src="img/screenshots/reusable-alert-dark-1.png" alt="App screenshot dark" /></p>
<p>This is how the dialog looks like in the alert example:</p>
<p><img src="img/screenshots/reusable-alert-dark-2.png" alt="App screenshot dark" /></p>
<blockquote>
<p>If you want to see an alert component very similar to the one we will write in this chapter, have a look at the <a href="https://github.com/Relm4/Relm4/blob/main/relm4-components/examples/alert.rs">“alert” example</a>. Run <code>cargo run --example alert</code> from the <a href="https://github.com/Relm4/Relm4/tree/main/relm4-components/examples">relm4-components/examples directory</a> if you want to see the code in action.</p>
</blockquote>
<h2 id="the-alert-component"><a class="header" href="#the-alert-component">The alert component</a></h2>
<p>The alert component is defined similar to the other components we've implemented in this book.</p>
<p>Our model stores whether the component is visible and the configuration.</p>
<pre><code class="language-rust ignore">/// Alert dialog component.
pub struct Alert {
    settings: AlertSettings,
    is_active: bool,
}</code></pre>
<p>We define a <code>Widgets</code>, <code>Init</code>, <code>Input</code> and <code>Output</code> type as usual.</p>
<pre><code class="language-rust ignore">    type Widgets = AlertWidgets;
    type Init = AlertSettings;
    type Input = AlertMsg;
    type Output = AlertResponse;</code></pre>
<p>The <code>Init</code> param is a settings object that is used to configure the component.
This maximizes the reusability of the component by letting it adapt to different use-cases.</p>
<pre><code class="language-rust ignore">/// Configuration for the alert dialog component
pub struct AlertSettings {
    /// Large text
    pub text: String,
    /// Optional secondary, smaller text
    pub secondary_text: Option&lt;String&gt;,
    /// Modal dialogs freeze other windows as long they are visible
    pub is_modal: bool,
    /// Sets color of the accept button to red if the theme supports it
    pub destructive_accept: bool,
    /// Text for confirm button
    pub confirm_label: String,
    /// Text for cancel button
    pub cancel_label: String,
    /// Text for third option button. If [`None`] the third button won't be created.
    pub option_label: Option&lt;String&gt;,
}</code></pre>
<p>In the <code>Input</code> type, this component uses <code>#[doc(hidden)]</code> on the <code>Response</code> variant. This is a useful pattern for component-internal messages that are not intended to be sent by outside callers. This allows us to update the component when the underlying dialog reports a response, but not display the <code>Response</code> variant in the component's documentation.</p>
<pre><code class="language-rust ignore">/// Messages that can be sent to the alert dialog component
#[derive(Debug)]
pub enum AlertMsg {
    /// Message sent by the parent to view the dialog
    Show,

    #[doc(hidden)]
    Response(gtk::ResponseType),
}</code></pre>
<p>The <code>Output</code> type allows us to report the user's response back to a parent component.</p>
<pre><code class="language-rust ignore">/// User action performed on the alert dialog.
#[derive(Debug)]
pub enum AlertResponse {
    /// User clicked confirm button.
    Confirm,

    /// User clicked cancel button.
    Cancel,

    /// User clicked user-supplied option.
    Option,
}</code></pre>
<p>The update function handles the <code>Show</code> message from our parent component and the <code>Response</code> messages generated by user interactions. It also sends the appropriate messages to the parent through the output sender.</p>
<pre><code class="language-rust ignore">    fn update(&amp;mut self, input: AlertMsg, sender: ComponentSender&lt;Self&gt;) {
        match input {
            AlertMsg::Show =&gt; {
                self.is_active = true;
            }
            AlertMsg::Response(ty) =&gt; {
                self.is_active = false;
                sender
                    .output(match ty {
                        gtk::ResponseType::Accept =&gt; AlertResponse::Confirm,
                        gtk::ResponseType::Other(_) =&gt; AlertResponse::Option,
                        _ =&gt; AlertResponse::Cancel,
                    })
                    .unwrap();
            }
        }
    }</code></pre>
<p>When initializing the model, we conditionally set up some widgets based on the settings passed by the caller. We set <code>is_active</code> to <code>false</code> since the dialog is not currently displayed.</p>
<pre><code class="language-rust ignore">    fn init(
        settings: AlertSettings,
        root: &amp;Self::Root,
        sender: ComponentSender&lt;Self&gt;,
    ) -&gt; ComponentParts&lt;Self&gt; {
        let model = Alert {
            settings,
            is_active: false,
        };

        let widgets = view_output!();

        if let Some(option_label) = &amp;model.settings.option_label {
            widgets
                .dialog
                .add_button(option_label, gtk::ResponseType::Other(0));
        }

        if model.settings.destructive_accept {
            let accept_widget = widgets
                .dialog
                .widget_for_response(gtk::ResponseType::Accept)
                .expect(&quot;No button for accept response set&quot;);
            accept_widget.add_css_class(&quot;destructive-action&quot;);
        }

        ComponentParts { model, widgets }
    }</code></pre>
<p>Lastly, the view. Note that the component connects to the <a href="https://docs.gtk.org/gtk4/signal.Dialog.response.html"><code>response</code>
signal</a> of the underlying dialog and sends an <em>input</em> to itself when a response is received.</p>
<pre><code class="language-rust ignore">    view! {
        #[name = &quot;dialog&quot;]
        gtk::MessageDialog {
            set_message_type: gtk::MessageType::Question,
            #[watch]
            set_visible: model.is_active,
            connect_response[sender] =&gt; move |_, response| {
                sender.input(AlertMsg::Response(response));
            },

            // Apply configuration
            set_text: Some(&amp;model.settings.text),
            set_secondary_text: model.settings.secondary_text.as_deref(),
            set_modal: model.settings.is_modal,
            add_button: (&amp;model.settings.confirm_label, gtk::ResponseType::Accept),
            add_button: (&amp;model.settings.cancel_label, gtk::ResponseType::Cancel),
        }
    }</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>With the component complete, let's use it!</p>
<pre><code class="language-rust ignore">struct App {
    counter: u8,
    alert_toggle: bool,
    dialog: Controller&lt;Alert&gt;,
    second_dialog: Controller&lt;Alert&gt;,
}

#[derive(Debug)]
enum AppMsg {
    Increment,
    Decrement,
    CloseRequest,
    Save,
    Close,
    Ignore,
}

#[relm4::component]
impl SimpleComponent for App {
    type Input = AppMsg;
    type Output = ();
    type Init = ();

    view! {
        main_window = gtk::ApplicationWindow {
            set_title: Some(&quot;Simple app&quot;),
            set_default_width: 300,
            set_default_height: 100,

            connect_close_request[sender] =&gt; move |_| {
                sender.input(AppMsg::CloseRequest);
                gtk::Inhibit(true)
            },

            gtk::Box {
                set_orientation: gtk::Orientation::Vertical,
                set_margin_all: 5,
                set_spacing: 5,

                append = &amp;gtk::Button {
                    set_label: &quot;Increment&quot;,
                    connect_clicked[sender] =&gt; move |_| {
                        sender.input(AppMsg::Increment);
                    },
                },
                append = &amp;gtk::Button {
                    set_label: &quot;Decrement&quot;,
                    connect_clicked[sender] =&gt; move |_| {
                        sender.input(AppMsg::Decrement);
                    },
                },
                append = &amp;gtk::Label {
                    set_margin_all: 5,
                    #[watch]
                    set_label: &amp;format!(&quot;Counter: {}&quot;, model.counter),
                },
                append = &amp;gtk::Button {
                    set_label: &quot;Close&quot;,
                    connect_clicked[sender] =&gt; move |_| {
                        sender.input(AppMsg::CloseRequest);
                    },
                },
            },
        }
    }

    fn update(&amp;mut self, msg: AppMsg, _sender: ComponentSender&lt;Self&gt;) {
        match msg {
            AppMsg::Increment =&gt; {
                self.counter = self.counter.wrapping_add(1);
            }
            AppMsg::Decrement =&gt; {
                self.counter = self.counter.wrapping_sub(1);
            }
            AppMsg::CloseRequest =&gt; {
                if self.counter == 42 {
                    relm4::main_application().quit();
                } else {
                    self.alert_toggle = !self.alert_toggle;
                    if self.alert_toggle {
                        self.dialog.emit(AlertMsg::Show);
                    } else {
                        self.second_dialog.emit(AlertMsg::Show);
                    }
                }
            }
            AppMsg::Save =&gt; {
                println!(&quot;* Open save dialog here *&quot;);
            }
            AppMsg::Close =&gt; {
                relm4::main_application().quit();
            }
            AppMsg::Ignore =&gt; (),
        }
    }

    fn init(_: (), root: &amp;Self::Root, sender: ComponentSender&lt;Self&gt;) -&gt; ComponentParts&lt;Self&gt; {
        let model = App {
            counter: 0,
            alert_toggle: false,
            dialog: Alert::builder()
                .transient_for(root)
                .launch(AlertSettings {
                    text: String::from(&quot;Do you want to quit without saving? (First alert)&quot;),
                    secondary_text: Some(String::from(&quot;Your counter hasn't reached 42 yet&quot;)),
                    confirm_label: String::from(&quot;Close without saving&quot;),
                    cancel_label: String::from(&quot;Cancel&quot;),
                    option_label: Some(String::from(&quot;Save&quot;)),
                    is_modal: true,
                    destructive_accept: true,
                })
                .forward(sender.input_sender(), convert_alert_response),
            second_dialog: Alert::builder()
                .transient_for(root)
                .launch(AlertSettings {
                    text: String::from(&quot;Do you want to quit without saving? (Second alert)&quot;),
                    secondary_text: Some(String::from(&quot;Your counter hasn't reached 42 yet&quot;)),
                    confirm_label: String::from(&quot;Close without saving&quot;),
                    cancel_label: String::from(&quot;Cancel&quot;),
                    option_label: Some(String::from(&quot;Save&quot;)),
                    is_modal: true,
                    destructive_accept: true,
                })
                .forward(sender.input_sender(), convert_alert_response),
        };

        let widgets = view_output!();

        ComponentParts { model, widgets }
    }
}

fn convert_alert_response(response: AlertResponse) -&gt; AppMsg {
    match response {
        AlertResponse::Confirm =&gt; AppMsg::Close,
        AlertResponse::Cancel =&gt; AppMsg::Ignore,
        AlertResponse::Option =&gt; AppMsg::Save,
    }
}

fn main() {
    let app = RelmApp::new(&quot;relm4.example.alert&quot;);
    app.run::&lt;App&gt;(());
}</code></pre>
<p>This is mostly stuff that we've already done in previous chapters, but there are a few additional things to know about interacting with child components.</p>
<p>Notably, we need to wrap the types of the child components in <code>Controller</code>s to be able to store them in the <code>App</code> model.</p>
<pre><code class="language-rust ignore">struct App {
    counter: u8,
    alert_toggle: bool,
    dialog: Controller&lt;Alert&gt;,
    second_dialog: Controller&lt;Alert&gt;,
}</code></pre>
<p>We initialize them with the builder pattern in the <code>init</code> method.</p>
<pre><code class="language-rust ignore">    fn init(_: (), root: &amp;Self::Root, sender: ComponentSender&lt;Self&gt;) -&gt; ComponentParts&lt;Self&gt; {
        let model = App {
            counter: 0,
            alert_toggle: false,
            dialog: Alert::builder()
                .transient_for(root)
                .launch(AlertSettings {
                    text: String::from(&quot;Do you want to quit without saving? (First alert)&quot;),
                    secondary_text: Some(String::from(&quot;Your counter hasn't reached 42 yet&quot;)),
                    confirm_label: String::from(&quot;Close without saving&quot;),
                    cancel_label: String::from(&quot;Cancel&quot;),
                    option_label: Some(String::from(&quot;Save&quot;)),
                    is_modal: true,
                    destructive_accept: true,
                })
                .forward(sender.input_sender(), convert_alert_response),
            second_dialog: Alert::builder()
                .transient_for(root)
                .launch(AlertSettings {
                    text: String::from(&quot;Do you want to quit without saving? (Second alert)&quot;),
                    secondary_text: Some(String::from(&quot;Your counter hasn't reached 42 yet&quot;)),
                    confirm_label: String::from(&quot;Close without saving&quot;),
                    cancel_label: String::from(&quot;Cancel&quot;),
                    option_label: Some(String::from(&quot;Save&quot;)),
                    is_modal: true,
                    destructive_accept: true,
                })
                .forward(sender.input_sender(), convert_alert_response),
        };

        let widgets = view_output!();

        ComponentParts { model, widgets }
    }</code></pre>
<p>We call <code>transient_for(root)</code> on the builder to indicate to GTK that our root widget is transient for the main application window. This allows window managers to handle the dialog window differently, e.g. by drawing it on top of other windows.
See the <a href="https://docs.gtk.org/gtk4/method.Window.set_transient_for.html"><code>set_transient_for</code> documentation</a> for more information.</p>
<pre><code class="language-rust ignore">            AppMsg::CloseRequest =&gt; {
                if self.counter == 42 {
                    relm4::main_application().quit();
                } else {
                    self.alert_toggle = !self.alert_toggle;
                    if self.alert_toggle {
                        self.dialog.emit(AlertMsg::Show);
                    } else {
                        self.second_dialog.emit(AlertMsg::Show);
                    }
                }
            }</code></pre>
<p>That's it! You can find more examples of reusable components in the
relm4-components crate <a href="https://docs.rs/relm4-components/latest/relm4_components/">here</a>.
You can also contribute your own reusable components to relm4-components :)</p>
<h2 id="the-complete-code"><a class="header" href="#the-complete-code">The complete code</a></h2>
<p>Let’s review all our code in one piece one more time to see how all these parts work together:</p>
<pre><code class="language-rust ignore">use gtk::prelude::*;
use relm4::prelude::*;
use relm4::Controller;

/// Configuration for the alert dialog component
pub struct AlertSettings {
    /// Large text
    pub text: String,
    /// Optional secondary, smaller text
    pub secondary_text: Option&lt;String&gt;,
    /// Modal dialogs freeze other windows as long they are visible
    pub is_modal: bool,
    /// Sets color of the accept button to red if the theme supports it
    pub destructive_accept: bool,
    /// Text for confirm button
    pub confirm_label: String,
    /// Text for cancel button
    pub cancel_label: String,
    /// Text for third option button. If [`None`] the third button won't be created.
    pub option_label: Option&lt;String&gt;,
}

/// Alert dialog component.
pub struct Alert {
    settings: AlertSettings,
    is_active: bool,
}

/// Messages that can be sent to the alert dialog component
#[derive(Debug)]
pub enum AlertMsg {
    /// Message sent by the parent to view the dialog
    Show,

    #[doc(hidden)]
    Response(gtk::ResponseType),
}

/// User action performed on the alert dialog.
#[derive(Debug)]
pub enum AlertResponse {
    /// User clicked confirm button.
    Confirm,

    /// User clicked cancel button.
    Cancel,

    /// User clicked user-supplied option.
    Option,
}

/// Widgets of the alert dialog component.
#[relm4::component(pub)]
impl SimpleComponent for Alert {
    type Widgets = AlertWidgets;
    type Init = AlertSettings;
    type Input = AlertMsg;
    type Output = AlertResponse;

    view! {
        #[name = &quot;dialog&quot;]
        gtk::MessageDialog {
            set_message_type: gtk::MessageType::Question,
            #[watch]
            set_visible: model.is_active,
            connect_response[sender] =&gt; move |_, response| {
                sender.input(AlertMsg::Response(response));
            },

            // Apply configuration
            set_text: Some(&amp;model.settings.text),
            set_secondary_text: model.settings.secondary_text.as_deref(),
            set_modal: model.settings.is_modal,
            add_button: (&amp;model.settings.confirm_label, gtk::ResponseType::Accept),
            add_button: (&amp;model.settings.cancel_label, gtk::ResponseType::Cancel),
        }
    }

    fn init(
        settings: AlertSettings,
        root: &amp;Self::Root,
        sender: ComponentSender&lt;Self&gt;,
    ) -&gt; ComponentParts&lt;Self&gt; {
        let model = Alert {
            settings,
            is_active: false,
        };

        let widgets = view_output!();

        if let Some(option_label) = &amp;model.settings.option_label {
            widgets
                .dialog
                .add_button(option_label, gtk::ResponseType::Other(0));
        }

        if model.settings.destructive_accept {
            let accept_widget = widgets
                .dialog
                .widget_for_response(gtk::ResponseType::Accept)
                .expect(&quot;No button for accept response set&quot;);
            accept_widget.add_css_class(&quot;destructive-action&quot;);
        }

        ComponentParts { model, widgets }
    }

    fn update(&amp;mut self, input: AlertMsg, sender: ComponentSender&lt;Self&gt;) {
        match input {
            AlertMsg::Show =&gt; {
                self.is_active = true;
            }
            AlertMsg::Response(ty) =&gt; {
                self.is_active = false;
                sender
                    .output(match ty {
                        gtk::ResponseType::Accept =&gt; AlertResponse::Confirm,
                        gtk::ResponseType::Other(_) =&gt; AlertResponse::Option,
                        _ =&gt; AlertResponse::Cancel,
                    })
                    .unwrap();
            }
        }
    }
}

struct App {
    counter: u8,
    alert_toggle: bool,
    dialog: Controller&lt;Alert&gt;,
    second_dialog: Controller&lt;Alert&gt;,
}

#[derive(Debug)]
enum AppMsg {
    Increment,
    Decrement,
    CloseRequest,
    Save,
    Close,
    Ignore,
}

#[relm4::component]
impl SimpleComponent for App {
    type Input = AppMsg;
    type Output = ();
    type Init = ();

    view! {
        main_window = gtk::ApplicationWindow {
            set_title: Some(&quot;Simple app&quot;),
            set_default_width: 300,
            set_default_height: 100,

            connect_close_request[sender] =&gt; move |_| {
                sender.input(AppMsg::CloseRequest);
                gtk::Inhibit(true)
            },

            gtk::Box {
                set_orientation: gtk::Orientation::Vertical,
                set_margin_all: 5,
                set_spacing: 5,

                append = &amp;gtk::Button {
                    set_label: &quot;Increment&quot;,
                    connect_clicked[sender] =&gt; move |_| {
                        sender.input(AppMsg::Increment);
                    },
                },
                append = &amp;gtk::Button {
                    set_label: &quot;Decrement&quot;,
                    connect_clicked[sender] =&gt; move |_| {
                        sender.input(AppMsg::Decrement);
                    },
                },
                append = &amp;gtk::Label {
                    set_margin_all: 5,
                    #[watch]
                    set_label: &amp;format!(&quot;Counter: {}&quot;, model.counter),
                },
                append = &amp;gtk::Button {
                    set_label: &quot;Close&quot;,
                    connect_clicked[sender] =&gt; move |_| {
                        sender.input(AppMsg::CloseRequest);
                    },
                },
            },
        }
    }

    fn update(&amp;mut self, msg: AppMsg, _sender: ComponentSender&lt;Self&gt;) {
        match msg {
            AppMsg::Increment =&gt; {
                self.counter = self.counter.wrapping_add(1);
            }
            AppMsg::Decrement =&gt; {
                self.counter = self.counter.wrapping_sub(1);
            }
            AppMsg::CloseRequest =&gt; {
                if self.counter == 42 {
                    relm4::main_application().quit();
                } else {
                    self.alert_toggle = !self.alert_toggle;
                    if self.alert_toggle {
                        self.dialog.emit(AlertMsg::Show);
                    } else {
                        self.second_dialog.emit(AlertMsg::Show);
                    }
                }
            }
            AppMsg::Save =&gt; {
                println!(&quot;* Open save dialog here *&quot;);
            }
            AppMsg::Close =&gt; {
                relm4::main_application().quit();
            }
            AppMsg::Ignore =&gt; (),
        }
    }

    fn init(_: (), root: &amp;Self::Root, sender: ComponentSender&lt;Self&gt;) -&gt; ComponentParts&lt;Self&gt; {
        let model = App {
            counter: 0,
            alert_toggle: false,
            dialog: Alert::builder()
                .transient_for(root)
                .launch(AlertSettings {
                    text: String::from(&quot;Do you want to quit without saving? (First alert)&quot;),
                    secondary_text: Some(String::from(&quot;Your counter hasn't reached 42 yet&quot;)),
                    confirm_label: String::from(&quot;Close without saving&quot;),
                    cancel_label: String::from(&quot;Cancel&quot;),
                    option_label: Some(String::from(&quot;Save&quot;)),
                    is_modal: true,
                    destructive_accept: true,
                })
                .forward(sender.input_sender(), convert_alert_response),
            second_dialog: Alert::builder()
                .transient_for(root)
                .launch(AlertSettings {
                    text: String::from(&quot;Do you want to quit without saving? (Second alert)&quot;),
                    secondary_text: Some(String::from(&quot;Your counter hasn't reached 42 yet&quot;)),
                    confirm_label: String::from(&quot;Close without saving&quot;),
                    cancel_label: String::from(&quot;Cancel&quot;),
                    option_label: Some(String::from(&quot;Save&quot;)),
                    is_modal: true,
                    destructive_accept: true,
                })
                .forward(sender.input_sender(), convert_alert_response),
        };

        let widgets = view_output!();

        ComponentParts { model, widgets }
    }
}

fn convert_alert_response(response: AlertResponse) -&gt; AppMsg {
    match response {
        AlertResponse::Confirm =&gt; AppMsg::Close,
        AlertResponse::Cancel =&gt; AppMsg::Ignore,
        AlertResponse::Option =&gt; AppMsg::Save,
    }
}

fn main() {
    let app = RelmApp::new(&quot;relm4.example.alert&quot;);
    app.run::&lt;App&gt;(());
}</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="threads_and_async/overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="widget_templates.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="threads_and_async/overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="widget_templates.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
