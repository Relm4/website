<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tips and tricks - GUI development with Relm4</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="basic_concepts/index.html"><strong aria-hidden="true">1.</strong> Basic concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basic_concepts/model.html"><strong aria-hidden="true">1.1.</strong> Model</a></li><li class="chapter-item expanded "><a href="basic_concepts/messages.html"><strong aria-hidden="true">1.2.</strong> Messages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basic_concepts/messages/input.html"><strong aria-hidden="true">1.2.1.</strong> Input</a></li><li class="chapter-item expanded "><a href="basic_concepts/messages/output.html"><strong aria-hidden="true">1.2.2.</strong> Output</a></li></ol></li><li class="chapter-item expanded "><a href="basic_concepts/widgets.html"><strong aria-hidden="true">1.3.</strong> Widgets</a></li><li class="chapter-item expanded "><a href="basic_concepts/components.html"><strong aria-hidden="true">1.4.</strong> Components</a></li></ol></li><li class="chapter-item expanded "><a href="first_app.html"><strong aria-hidden="true">2.</strong> Your first app</a></li><li class="chapter-item expanded "><a href="component_macro.html"><strong aria-hidden="true">3.</strong> The component macro</a></li><li class="chapter-item expanded "><a href="tricks.html" class="active"><strong aria-hidden="true">4.</strong> Tips and tricks</a></li><li class="chapter-item expanded "><a href="efficient_ui/index.html"><strong aria-hidden="true">5.</strong> Efficient UI updates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="efficient_ui/tracker.html"><strong aria-hidden="true">5.1.</strong> Tracker</a></li><li class="chapter-item expanded "><a href="efficient_ui/factory.html"><strong aria-hidden="true">5.2.</strong> Factories</a></li><li class="chapter-item expanded "><a href="efficient_ui/factory_position.html"><strong aria-hidden="true">5.3.</strong> The position function</a></li></ol></li><li class="chapter-item expanded "><a href="components.html"><strong aria-hidden="true">6.</strong> Components</a></li><li class="chapter-item expanded "><a href="threads_and_async/index.html"><strong aria-hidden="true">7.</strong> Threads and async</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="threads_and_async/worker.html"><strong aria-hidden="true">7.1.</strong> Workers</a></li><li class="chapter-item expanded "><a href="threads_and_async/commands.html"><strong aria-hidden="true">7.2.</strong> Commands</a></li><li class="chapter-item expanded "><a href="threads_and_async/async.html"><strong aria-hidden="true">7.3.</strong> Async components and factories</a></li><li class="chapter-item expanded "><a href="threads_and_async/overview.html"><strong aria-hidden="true">7.4.</strong> Overview</a></li></ol></li><li class="chapter-item expanded "><a href="child_components.html"><strong aria-hidden="true">8.</strong> Child components</a></li><li class="chapter-item expanded "><a href="widget_templates/index.html"><strong aria-hidden="true">9.</strong> Widget templates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="widget_templates/accessing_nested_template_elements.html"><strong aria-hidden="true">9.1.</strong> Accessing Nested Template Elements</a></li></ol></li><li class="chapter-item expanded "><a href="cli.html"><strong aria-hidden="true">10.</strong> Command Line Interfaces</a></li><li class="chapter-item expanded "><a href="gtk_rs.html"><strong aria-hidden="true">11.</strong> gtk-rs overview</a></li><li class="chapter-item expanded "><a href="resource_bundles.html"><strong aria-hidden="true">12.</strong> Resource Bundles</a></li><li class="chapter-item expanded "><a href="continuous_integration.html"><strong aria-hidden="true">13.</strong> Continuous Integration guide</a></li><li class="chapter-item expanded "><a href="component_macro/reference.html"><strong aria-hidden="true">14.</strong> Component macro reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="component_macro/expansion.html"><strong aria-hidden="true">14.1.</strong> Macro expansion</a></li></ol></li><li class="chapter-item expanded "><a href="migrations/index.html"><strong aria-hidden="true">15.</strong> Migration guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="migrations/0_2_to_0_4.html"><strong aria-hidden="true">15.1.</strong> 0.2 to 0.4</a></li><li class="chapter-item expanded "><a href="migrations/0_4_to_0_5.html"><strong aria-hidden="true">15.2.</strong> 0.4 to 0.5</a></li><li class="chapter-item expanded "><a href="migrations/0_5_to_0_6.html"><strong aria-hidden="true">15.3.</strong> 0.5 to 0.6</a></li><li class="chapter-item expanded "><a href="migrations/0_6_to_0_7.html"><strong aria-hidden="true">15.4.</strong> 0.6 to 0.7</a></li><li class="chapter-item expanded "><a href="migrations/0_7_to_0_8.html"><strong aria-hidden="true">15.5.</strong> 0.7 to 0.8</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GUI development with Relm4</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Relm4/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Relm4/book/edit/main/src/tricks.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tips-and-tricks"><a class="header" href="#tips-and-tricks">Tips and tricks</a></h1>
<p>This chapter comes quite early in the book because it is quite helpful for beginners, but is certainly also useful for more advanced users.
It  contains the most common tips and tricks you will need while using Relm4.
In case you have a problem, you can simply return to this chapter and might find something helpful very quickly.
We recommend to have at least a short look at this chapter, but there's no crucial information in here so you can already continue with the next chapter if you want.</p>
<h2 id="advanced-view-macro-features"><a class="header" href="#advanced-view-macro-features">Advanced view macro features</a></h2>
<p>Some features of the view macro are explained very late in the book and are easy to overlook.
Here's a short summery of those features, which you might find useful.
If you found something interesting, you can look for more details in the <a href="./component_macro/reference.html">macro reference chapter</a>.</p>
<ul>
<li>Initialization using a builder pattern</li>
<li>Pass additional arguments</li>
<li>Pass <code>Some(widget)</code></li>
<li><code>if</code> and <code>match</code> statements to dynamically select visible widgets</li>
<li>Use the return value of assignments</li>
<li>Optional and iterative assignments</li>
</ul>
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common pitfalls</a></h2>
<p>The Elm architecture itself is pretty simple, but as your application grows, small oversights can sometimes cause large problems.</p>
<h3 id="message-recursion"><a class="header" href="#message-recursion">Message recursion</a></h3>
<p>Relm4 components use a simple update loop: Receive a message, update the model and then update the view.
Usually, this works as intended, but if updating the view somehow creates a new, identical message, your code will be stuck in an infinite loop and your app will freeze.
To prevent this, the view macro has the <code>block_signal</code> attribute which is explained <a href="./component_macro/reference.html#blocking-signals-temporarily">here</a>.</p>
<h3 id="sending-errors"><a class="header" href="#sending-errors">Sending errors</a></h3>
<p>Sending messages in Relm4 can lead to panics under certain circumstances.
The most common mistake is dropping a <code>Controller</code>.
This will cause the entire runtime of the component to be dropped together with all it's receivers.
Sending message to this component afterwards will not work because the receiving side is not available anymore.
To avoid this problem, you can either store the <code>Controller</code> in the model of its parent components or call <a href="https://docs.rs/relm4/latest/relm4/component/struct.Controller.html#method.detach_runtime"><code>detach_runtime()</code></a>.</p>
<p>Also note that sending output messages will not work if you <a href="https://docs.rs/relm4/latest/relm4/component/struct.Connector.html#method.detach"><code>detach</code></a> a component, again because this means that no receiver is available.
In this case it might be desired to ignore sending errors.</p>
<h2 id="common-compiler-errors"><a class="header" href="#common-compiler-errors">Common compiler errors</a></h2>
<p>Relm4's macros try to make your life easier, but sometimes the created error messages are rather confusing.
This is not something that can be fully fixed in the macro itself due to the limitations of the Rust programming language, but we try to summarize some common errors in this section.</p>
<h3 id="private-type-in-public-interface"><a class="header" href="#private-type-in-public-interface">Private type in public interface</a></h3>
<p>The <code>#[component]</code> and <code>#[factory]</code> macros will automatically generate a struct for storing your widgets.
This struct must have the same visibility as the model because it is associated with the <code>Component</code> or <code>FactoryComponent</code> implementation of the model.
To tell the macro to generate a public widgets type, you can simply use <code>#[component(pub)]</code> or <code>#[factory(pub)]</code>.</p>
<h3 id="method-container_add-is-missing"><a class="header" href="#method-container_add-is-missing">Method <code>container_add</code> is missing</a></h3>
<p>Relm4 implements the <a href="https://docs.rs/relm4/latest/relm4/trait.RelmContainerExt.html#tymethod.container_add"><code>ContainerExt</code></a> trait for many widgets that allows you simply nest widgets in the view macro.</p>
<pre><code class="language-rust ignore">gtk::Box {
    gtk::Label {
        // ...
    }
}</code></pre>
<p>Unfortunately, this trait can't always be implemented because some widgets don't have a obvious method for adding children.
For <code>gtk::Box</code> it is relatively simple and just uses the <code>append()</code> method internally.
However, <code>gtk::Header</code> has three possible locations to add children: start, center and end.
Implementing <code>RelmContainerExt</code> for such a type is not possible because it's not clear what the default behavior should be.
Other types such as <code>gtk::Grid</code> even need more information to place children.
In this case, you can simply pass the method name before declaring the child widget.
Also, we often need a reference (<code>&amp;</code>) because most methods in gtk-rs take references.</p>
<pre><code class="language-rust ignore">gtk::HeaderBar {
    pack_start = &amp;gtk::Label {
        // ...
    }
},
gtk::Grid {
    attach[0, 0, 1, 1] = &amp;gtk::Label {
        // ...
    }
}</code></pre>
<h2 id="working-with-gtk-rs"><a class="header" href="#working-with-gtk-rs">Working with gtk-rs</a></h2>
<p>The structure and design of most gtk-rs crates is often a bit different from most other Rust crates.
Because GTK is based on GObject, a C library that implements object-oriented programming, the gtk-rs developers had to come up with some clever ideas to integrate the C code into Rust.</p>
<h3 id="reading-docs"><a class="header" href="#reading-docs">Reading docs</a></h3>
<p>Looking at the documentation of <a href="https://gtk-rs.org/gtk4-rs/git/docs/gtk4/struct.Box.html"><code>gtk::Box</code></a> makes it look like this type has just a <code>new()</code> and a <code>builder()</code> method.
However, this is not quite true as the <code>gtk::Box</code> type comes with plenty of methods.
To find those methods, you have to look at <a href="https://gtk-rs.org/gtk4-rs/git/docs/gtk4/struct.Box.html#implements">"implements" section</a>, which contains a list of traits implemented by this type.
In particular, <a href="https://gtk-rs.org/gtk4-rs/git/docs/gtk4/prelude/trait.BoxExt.html"><code>BoxExt</code></a> gives you a lot of useful methods.
Another very important trait in the list is <a href="https://gtk-rs.org/gtk4-rs/git/docs/gtk4/prelude/trait.WidgetExt.html"><code>WidgetExt</code></a> which is implemented by all widgets.
In the same fashion, you can find the available methods of other widgets.</p>
<h3 id="using-the-inspector"><a class="header" href="#using-the-inspector">Using the inspector</a></h3>
<p>GTK has a built-in inspector that has similar features as browser developer tools.
You can use them to look at individual widgets, modify their properties, apply custom CSS and much more.
In particular, it is very useful for finding the best values before integrating them into your code.</p>
<p>To use the inspector, you only need to press <code>Ctrl+Shift+D</code> while you have a GTK application opened (this not just works for Relm4, but all GTK based apps).
You should see an overview over all your widgets, which you can expand row by row.
Yet, to select widgets, it is more convenient to use the button in the top left which allows you to select a widget by clicking on your app.
Once you have selected a widget, you can modify its properties.</p>
<p>You can also use the CSS tab to apply custom CSS to your application.
Once you entered your rules, make sure the pause button is not selected.
For example, you could try setting a border for every widget:</p>
<pre><code class="language-css">* {
    border: 1px solid red;
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Widget overview</th><th>Widget properties</th></tr></thead><tbody>
<tr><td><img src="img/inspector1.png" alt="Widget overview" /></td><td><img src="img/inspector2.png" alt="Widget properties" /></td></tr>
</tbody></table>
</div>
<h3 id="demo-applications"><a class="header" href="#demo-applications">Demo applications</a></h3>
<p>Both GTK4, libadwaita and ASHPD (a library for portals) have demo applications.
Those are very useful when searching for widgets and other features, especially when combined with the inspector.</p>
<ul>
<li>Setup gnome-nightly flatpak remote: <code>flatpak remote-add --if-not-exists gnome-nightly https://nightly.gnome.org/gnome-nightly.flatpakrepo</code></li>
<li>Install the GTK4 demo: <code>flatpak install gnome-nightly org.gtk.Demo4</code></li>
<li>Install the Adwaita demo: <code>flatpak install gnome-nightly org.gnome.Adwaita1.Demo</code></li>
<li>Install the ASHPD demo: <code>flatpak install flathub com.belmoussaoui.ashpd.demo</code></li>
</ul>
<h2 id="our-ecosystem"><a class="header" href="#our-ecosystem">Our ecosystem</a></h2>
<p>Relm4 also offers a few extra crates and projects to make your life easier:</p>
<ul>
<li><a href="https://github.com/Relm4/relm4-template">relm4-template</a>: A template for flatpak apps that saves a lot of time for setting up new projects</li>
<li><a href="https://github.com/Relm4/icons">relm4-icons</a>: Over 2000 icons, ready to use for your app</li>
<li><a href="https://docs.rs/relm4-components/latest/relm4_components/">relm4-components</a>: A collection of handy components</li>
</ul>
<h2 id="guaranteed-helpful-our-matrix-chat"><a class="header" href="#guaranteed-helpful-our-matrix-chat">Guaranteed helpful: Our matrix chat</a></h2>
<p>In case you didn't find the answer to your question in this book, feel free to ask it in our matrix chat or in a GitHub discussion (you can find all links in our <a href="https://github.com/Relm4/Relm4#readme">README</a>).
We are always happy to help you!
After all, this chapter was assembled from the most common questions we got from either GitHub or the matrix chat.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="component_macro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="efficient_ui/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="component_macro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="efficient_ui/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
